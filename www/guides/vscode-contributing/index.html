<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lever - Contributing</title>
    <link rel="stylesheet" href="../../stylesheet.css">
<style>
body { margin-left: 60px; margin-right: 60px; }
p { text-align: justify; }
.editalert { color: #990000; font-weight: bold; font-style: italic; display: none; }
.secttitle { color: #996103; font-weight: bold; }
</style>    
</head>
<body>

<ul class="nav">
<li><a href="../../"><img src="../../logo.png" alt="LEVER"></a></li>
<li><a class="nav_button" href="https://github.com/cheery/lever/">repository</a></li>
<li><a class="nav_button" href="/index.html#download">download</a></li>
</ul>
<h1 class="embed-header">Contributing to Lever</h1>
<p>
This is one in a series of guides discussing software tools and their use in
Lever projects. This guide gives you the basics of contributing to Lever.
</p><p>
This guide will walk you through compiling the lever runtime and creating a
distributable from it. It will also show how to implement a missing
functionality, or how to improve documentation on the website and in the
repository.
</p><p>
In this guide we use Visual Studio Code. We assume you use Windows on some
points.
</p>
<h2 class="secttitle">1. Prerequisites.</h2>
<p>
You may have to read these articles first, if you haven't done it yet:
</p>
<ul>
    <li><a href="../vscode-getting-started">Getting started with Visual Studio
            Code</a></li>
    <li><a href="../vscode-git-github">Leveraging Git&amp;Github</a></li>
</ul>
<h2 class="secttitle">2. Obtain the repository</h2>
<p>
First get yourself an online repository where to push your work for review.
You can make one by pressing the 'fork' button at the Lever's
<a href="https://github.com/cheery/lever/">github repository</a>.
You need to sign up to fork.
</p>
<img src="contrib01.png">
<p>
Now you have online repository for lever where you can push your changes when
you are done.
</p><p>
Next you should clone your online repository to your computer. Easiest way is to
do 'Git Bash Here' then type "git clone " and paste the URL of your repository
after.
</p>
<img src="contrib02.png">
<img src="contrib03.png">
<h2 class="secttitle">3. Open the repository in your editor</h2>
<p>
The git clone created a lever repository to where you issued it. Next you should
'File' -&gt; 'Open Folder' to get it into your editor:
</p>
<img src="contrib04.png">
<h2 class="secttitle">4. Lots of things to contribute</h2>
<p>
There are various things one could do to Lever. So at this point this guide has
been divided into many parts. But there is one important thing to discuss before
we go ahead.
</p>
<h3 class="secttitle">4-0. Fears and other metacognitive brakes</h3>
<p>
If you have been following this guide this far. You shouldn't stop.
</p>
<p>
I have programmed Lever myself. I have been programming for nearly 20 years. I
know fears of different kinds can put people to stop what they wanted to do.
If you don't have such fears, here are some to start with:
</p>
<ul>
    <li>"What if I am not good enough?"</li>
    <li>"What if he rejects my contribution?"</li>
    <li>"What if I cannot do it?"</li>
    <li>"What if he's just behind me?"</li>
</ul>
<p>
You may also stumble upon difficulties:
</p>
<ul>
    <li>"This is harder than it looks"</li>
    <li>"This is very hard"</li>
</ul>
<p>
And sometimes the outcome is some of the following:
</p>
<ul>
    <li>"This thing I did sucks"</li>
    <li>"I can't do it"</li>
    <li>"I can't do it properly"</li>
    <li>"I won't do it"</li>
    <li>"I am not a programmer, I do not need to do this"</li>
    <li>"I am not for this"</li>
    <li>"I am too old for this"</li>
    <li>"I will be ridiculed for trying"</li>
</ul>
<p>
You may want to study these thoughts. They are common, they are meant to keep
you on the safe side. Sometimes they prevent you from going ahead.
</p>
<p>
You can learn new things when you try. And things you try don't need to be in
your profession to help you.
</p>
<p>
You have some motivation why you've read so far into this post. If it's easy to
write it down, write it on post-it-note and glue to where you see it.
</p>
<p>
Also I could really use some non-programmers here. Some people who know very
little and like to learn things and won't stop to the first obstacles they see
would be really good help at writing documentation. Or if you handle some
profession, oh it's interesting to hear what you think and what you write down. 
</p>
<p>
There is real possibility that I reject commits. This shouldn't discourage you.
If I ever reject a commit, I will explain why I rejected it and what can be done
to get it through. I will try to be rational about this and minimize drama.
</p>
<p>
There is also a possibility that people ridicule you. But that really also
happens even if you did nothing. Don't give a shit what people think of you.
Don't let that to affect your mood or motivation. Don't get angered or
agravated. This will require lots of training. You should do it.
</p>
<p>
Whatever you're going to do, try to do it well. Just don't fear to push just
because it went bad.
</p>
<h3>4-1. A missing function</h3>
<p>
There are some really easy places to contribute when you look around. Lever is
straight out missing functionality at places. For example, we are supposed to
support most methods for base types that are in Python. But there are lots of
omissions.
</p>
<p>
For example, there was dict.update() missing some while ago.
</p>
<img src="contrib05.png">
<p>
Now there are some interesting things to note before you get to implement a
missing functionality you find.
</p>
<p>
Some things in Lever are done slightly different ways. For example.
The very first person who contributed to Lever wrote a 'len()' function.
Lever uses '.length' -convention from Javascript. While he was working he
noticed that we got '.length'. And implemented the 'len()' in terms of
'.length'.  Well I took his commit in. Though I should have really rejected it.
I've kept it in the runtime as an easter egg. :-)
</p>
<p>
Your best bet here is to do some analysis. Is there a Lever way to do the thing
this function did? Is there a purpose for this function? In this case '.update'
is redundant. It is a good idea to write down your thoughts when analyse, that
increases the chances that you succeed.
</p>
<p>
dict.update() puts the values into the dictionary. The implementation in Lever
would be possible:
</p>
<pre>update = (self, other):
    if isinstance(other, dict):
        for key in other
            self[key] = other[key]
    else
        for item in other
            self[item[0]] = item[1]
</pre>
<p>
dict.update() is part of the list comprehension elements in Python. Lever also
appreciates list comprehensions as they are very expressive constructs.
</p>
<p>
There is a set.update() of similar behavior.
</p>
<img src="contrib06.png">
<p>
So the function is redundant, but every other reason points out it should be in
Lever. Therefore implementing it will drive Lever forward.
</p>
<p>
I expect that people will contribute from need to extend lever while using it.
Some explanation and analysis for the feature are even then very welcome.
</p>
<p>
It can happen that your analysis reveals that you don't need to extend Lever. If at
the beginning you believed you did, it's likely that someone else thoughts same.
It will be valuable to commit a report of your analysis as a .txt file, into analysis/
-directory of Lever.
</p>
<h3>4-2. Runtime development tools</h3>
<p>
If you edit lib/ it usually can be tested out with lever runtime.
</p>
<p>
When changing the runtime or compiler of Lever, you should get yourself the
tools to compile a new runtime.
</p>
<p>
Go to <a href="https://www.python.org/downloads/windows/">Python download page</a>
</p>
<p>
Next thing is important as RPython cannot translate to 64-bit executables on
Windows, and it depends on bit-width of the Python. You need to download the
"Windows x86 installer" from the download page that is for 32-bit environment.
Also be sure that it is the Python 2.7 installer. The version number should appear
in the start of the install.
</p>
<img src="contrib07.png">
<p>
It's okay to install the Python into C:\Python27 because it's usually expected
to be there.
</p>
<p>
It's good idea to configure python to add itself into the PATH. Although it may
be you have to restart your computer to have the PATH rule go to effect.
</p>
<img src="contrib08.png">
<p>
Next you need to download &amp; install 
<a href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">
    Microsoft Visual C++ Compiler for Python 2.7</a>
The Microsoft tends to mess up their URLs from time to time.
If the link doesn't work, do a search to find this installer. Just make sure it
comes from Microsoft owned -url. Install it just like usual.
</p>
<img src="contrib09.png">
<p>
Now you should be able to open a command line for this compiler from the start
menu of your Windows.
</p>
<img src="contrib10.png">
<h3>4-3. Write the missing code</h3>
<p>
The prerequisite for implementing a function into Lever is that you know how to
write Python code. Also you may want to read the
<a href="http://rpython.readthedocs.io/en/latest/">RPython manual</a> to know
what kind of limitations the Lever runtime requires.
</p>
<p>
Come up with a sample program into samples/ -directory first. It can be simple
and descriptive.
</p>
<p>
The internal documentation points out the rest of dictionary methods can be
found from the runtime/space/dictionary.py
</p>
<p>
Write your implementation for Dict_update.
</p>
<p>
Here's a mini-guide for test your program after compiling. Press F5 and select
'Lever Runtime'
</p>
<img src="contrib11.png">
<p>
Put "${file}" into the "program" -option, so that the currently shown file gets
run instead of the 'main.lc'. You may also like to change the "lever_path" into
"${workspaceRoot}", because we are developing Lever.
</p>
<img src="contrib12.png">
<p>
You should get this kind of ENOENT -error when you try to run your
'dictionaries.lc'. This happens because your runtime doesn't have lever
executable yet.
</p>
<img src="contrib13.png">
<p>
If you change the "lever_path" back to proper runtime, you should get the
following error. It is clear that .update isn't there. If you do this, switch
the lever's path back to this project, because you are going to compile a new
runtime next.
</p>
<img src="contrib14.png">
<p>
There has been situation that my anti-virus software interferes with the
debugger. If that happens then the debug console doesn't open. Restarting the
Visual Studio Code seem to have helped when that happens.
</p>
<h3>4-4. Translate &amp; Test the runtime</h3>
<p>
To verify your implementation works, you need to translate the Lever runtime.
</p>
<p>
To do it, you will do that from the command line tool obtained two sections
back. With the "Visual C++ 2008 32-bit Command Prompt". Navigate to your lever
directory with a 'cd' -command.
<img src="contrib17.png">
</p>
<p>
In the Lever 0.8.0 there is one complication due to RPython bug. This bug has
been reported and fixed days ago, and it will not be present in the next PyPy
and next Lever release.
</p>
<p>
Run the "python setup.py" -command, if it says 'is not recognized', check a
troubleshoot for this few images below.
</p>
<p>
For now you need to rewrite the following two lines in
pypy2-v5.3.1-src/rpython/rlib/rposix.py
</p>
<img src="contrib15.png">
<img src="contrib16.png">
<p>Remember to save these changes before a running the next command:</p>
<p>
Write: 'python setup.py compile'
</p>
<img src="contrib18.png">
<p>
This triggers a full compile to your runtime and gives you a lever executable
you can use to develop lib/ -features. If you're only working on the lib/, it is
also useful to know the 'compile-lib' and 'compile-lib-all' commands. These
commands use the bootstrapping compiler to compile everything in the lib/
-directory. The later command forces recompile for all files in the lib/.
</p>
<p>
There is also 'compile-nojit' command to provide shorter compile time. But the
resulting interpreter won't be able to JIT the code.
</p>
<img src="contrib19.png">
<p>And if it runs successfully, it should look about like this.</p>
<img src="contrib20.png">
<p>
Now verify that your lever path refers to this runtime. You're about done with
the implementation once your sample program runs properly.
</p>
<p>
If you need the change immediately, there's the win32_dist.py -script that can
create a new package with Lever.
</p>
<h3>4-5. New documentation</h3>
<p>
If you implemented a feature, remember to update the internal_documentation.txt
to let people know that there's a feature for that now. This is all what feature
implementation requires.
</p>
<p>
Lever follows documentation-flows-upwards convention. In this convention the
libraries and programs get a detailed description. Every file gets a description
about why it is there, what led to its creation, what it implements and so on.
These are collected into categories.
</p>
<p>
Reference documentation for functions will be written into doc/ and it will get
a machine-readable format to allow it to be supplied into runtime from there.
For now we have no reference documentation.
</p>
<p>
If you need to add images to the documentation. You can add them as usual. The
preferred format is PNG and it's nice, but optional to use
<a href="optipng.sourceforge.net">optipng</a> on them before committing.
</p>
<p>
Guides are directly written into html files at guides/ -directory.
Creation of a new guide requires a similar analysis as what code did.
</p>
<h3>4-5. Troubleshooting</h3>
<p>
There's possible that something goes wrong. For example the error below comes if
you didn't patch the rpython. It's a well-known problem and the solution is
documented on this page, so only request troubleshooting if you get a new
twist to it.
</p>
<p>
This part of a guide will shorten considerably the time for you to get help with
Lever. When you stumble upon an issue. Capture the logs and copy them. In the
console you can do this by right clicking the window and pressing 'select all'.
</p>
<img src="contrib23.png">
<p>
The screen gets coloured white. In this mode press 'enter'. The screen recovers
to what it was.
</p>
<img src="contrib24.png">
<p>
Go into <a href="gist.github.com">gist.github.com</a> and paste your error log
there. Press 'create public gist'. You must be logged into github to do this.
Any other pastebin site works as well.
</p>
<img src="contrib25.png">
<p>
On <a href="github.com/cheery/lever/issues">our issues page</a>, press 'new
issue' button. Describe the problem you encountered. Add a link to the paste you
created. Explain what changes you've done and how you've diverted from the
instructions of the guide. You can use the 'snip' -tool on windows 10 to provide
us screenshots.
</p>
<p>
Details are fun. They provide us something we can react upon and provide the
knowledge we need to troubleshoot.
</p>
<img src="contrib26.png">
<p>
This will let us know that you have a problem, and we will get to help you out
asap.
</p>
<h2>5. Commit the changes and Push</h2>
<p>
You can do several commits, but please don't commit all the time. At worst,
commit files once in a day after a productive session.
</p>
<img src="contrib21.png">
<p>
Push the files using your preferred way to you server.
</p>
<img src="contrib22.png">
<p>
When you think your work can be contributed, you can then finally write a pull
request. There should be a 'new pull request' -button on the Lever repository.
Go push that and step through.
</p>
<p>
Next you get to wait for my response.
</p>
<hr/>
<p>
If you've worked this through, you should be ready to contribute on Lever
development. Chances are you are ready to contribute to most other RPython
-related open source projects, including PyPy itself.
</p>
<p>
To have no trouble with them, please follow the respective conventions they have
with their projects. For example. The documentation cycle Lever follows is
unique to Lever and Lever-related projects. The compiling tools Lever uses are
unique to RPython related projects, but only Lever has setup.py -script wired
like this.
</p>
<p>
You will discover which conventions each project follows by reading their
documentation. 
</p>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-12626354-9', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
